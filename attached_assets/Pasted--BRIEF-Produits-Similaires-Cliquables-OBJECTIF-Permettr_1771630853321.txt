
# BRIEF : Produits Similaires Cliquables

## ğŸ¯ OBJECTIF
Permettre de cliquer sur un produit similaire dÃ©tectÃ© lors de la crÃ©ation pour accÃ©der directement Ã  sa page dÃ©tail.

## ğŸ“¸ CONTEXTE

**Ã‰cran actuel :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nouveau produit                       [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nom du produit *                          â”‚
â”‚ [chaussure 44________________]            â”‚
â”‚                                           â”‚
â”‚ âš ï¸ Produits similaires dÃ©tectÃ©s           â”‚
â”‚                                           â”‚
â”‚ PAIRE CHAUSSURES - 44 (EPI)     65%      â”‚
â”‚ PAIRE CHAUSSURES - 41 (EPI)     50%      â”‚
â”‚ PAIRE CHAUSSURES - 42 (EPI)     50%      â”‚
â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ProblÃ¨me :** Les produits similaires ne sont pas cliquables. L'user doit :
1. Fermer le modal
2. Chercher "PAIRE CHAUSSURES - 44" dans la liste
3. Cliquer dessus pour voir le dÃ©tail

**Solution :** Rendre les lignes cliquables â†’ redirection directe vers le produit.

---

## ğŸ› ï¸ IMPLÃ‰MENTATION

### 1. Rendre les lignes cliquables

**UI souhaitÃ©e :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Produits similaires dÃ©tectÃ©s           â”‚
â”‚                                           â”‚
â”‚ [PAIRE CHAUSSURES - 44 (EPI)    65% â†’]   â”‚  â† Ligne cliquable
â”‚ [PAIRE CHAUSSURES - 41 (EPI)    50% â†’]   â”‚
â”‚ [PAIRE CHAUSSURES - 42 (EPI)    50% â†’]   â”‚
â”‚                                           â”‚
â”‚ [Aucun ne correspond, crÃ©er nouveau]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Design :**
- Effet hover : fond gris clair + curseur pointer
- IcÃ´ne flÃ¨che "â†’" ou "â†—" Ã  droite de chaque ligne
- Transition douce (0.2s)

### 2. Composant ProduitSimilaireItem

Dans `client/src/components/ProduitSimilaireAlert.tsx` (ou fichier Ã©quivalent) :

```tsx
import { useNavigate } from 'react-router-dom';
import { ExternalLink } from 'lucide-react';

interface ProduitSimilaire {
  id: number;
  nom: string;
  categorie: string;
  score: number; // 0.50 = 50%
}

function ProduitSimilaireItem({ produit }: { produit: ProduitSimilaire }) {
  const navigate = useNavigate();
  
  const handleClick = () => {
    // Fermer le modal de crÃ©ation
    // (supposant que onClose est passÃ© en props au composant parent)
    
    // Rediriger vers la page produit
    navigate(`/produits/${produit.id}`);
  };
  
  const scorePercent = Math.round(produit.score * 100);
  
  return (
    <button
      onClick={handleClick}
      className="w-full flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer text-left border border-transparent hover:border-teal-200"
    >
      <div className="flex-1">
        <div className="font-medium text-gray-900">
          {produit.nom}
        </div>
        <div className="text-sm text-gray-500">
          {produit.categorie}
        </div>
      </div>
      
      <div className="flex items-center space-x-3">
        <span className={`text-sm font-medium ${
          scorePercent >= 70 ? 'text-orange-600' :
          scorePercent >= 50 ? 'text-yellow-600' :
          'text-gray-600'
        }`}>
          {scorePercent}%
        </span>
        <ExternalLink size={16} className="text-gray-400" />
      </div>
    </button>
  );
}
```

### 3. IntÃ©grer dans l'Alert

Dans le composant d'alerte des produits similaires :

```tsx
function ProduitSimilaireAlert({ 
  produitsSimilaires, 
  onClose // Fonction pour fermer le modal de crÃ©ation
}: {
  produitsSimilaires: ProduitSimilaire[];
  onClose: () => void;
}) {
  return (
    <Alert variant="warning" className="mb-4">
      <AlertTriangle className="h-4 w-4" />
      <AlertTitle>Produits similaires dÃ©tectÃ©s</AlertTitle>
      <AlertDescription>
        <div className="mt-3 space-y-2">
          {produitsSimilaires.map((produit) => (
            <ProduitSimilaireItem 
              key={produit.id} 
              produit={produit}
            />
          ))}
        </div>
        
        <div className="mt-4 pt-3 border-t border-gray-200">
          <p className="text-sm text-gray-600 mb-2">
            Aucun ne correspond ?
          </p>
          <Button 
            variant="outline" 
            size="sm"
            onClick={onClose} // Reste sur le modal pour continuer la crÃ©ation
          >
            CrÃ©er un nouveau produit
          </Button>
        </div>
      </AlertDescription>
    </Alert>
  );
}
```

### 4. Fermer le modal avant redirection

Dans le composant modal parent (ex: `NouveauProduitModal.tsx`) :

```tsx
function NouveauProduitModal({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) {
  const [nom, setNom] = useState('');
  const [produitsSimilaires, setProduitsSimilaires] = useState<ProduitSimilaire[]>([]);
  
  // Recherche de similaritÃ© (dÃ©jÃ  implÃ©mentÃ©)
  const { data: similaires } = useQuery({
    queryKey: ['produits-similaires', nom, categorie],
    queryFn: async () => {
      const res = await fetch(`/api/referentiel/produits/search?q=${nom}&categorie=${categorie}`);
      return res.json();
    },
    enabled: nom.length > 3,
  });
  
  useEffect(() => {
    if (similaires?.resultats) {
      setProduitsSimilaires(similaires.resultats);
    }
  }, [similaires]);
  
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Nouveau produit</DialogTitle>
          <DialogDescription>
            Ajoutez un produit au rÃ©fÃ©rentiel centralisÃ©
          </DialogDescription>
        </DialogHeader>
        
        <div className="space-y-4">
          <div>
            <Label>Nom du produit *</Label>
            <Input
              value={nom}
              onChange={(e) => setNom(e.target.value)}
              placeholder="Ex: Paire Chaussures - 44"
            />
          </div>
          
          {/* Alerte produits similaires */}
          {produitsSimilaires.length > 0 && (
            <ProduitSimilaireAlert 
              produitsSimilaires={produitsSimilaires}
              onClose={onClose} // Passer la fonction de fermeture
            />
          )}
          
          {/* Reste du formulaire... */}
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

### 5. Ouvrir automatiquement le dÃ©tail produit

Dans la page produits (ex: `ProduitsPage.tsx`) :

**Option A : Panneau latÃ©ral (Drawer)**
```tsx
function ProduitsPage() {
  const { id } = useParams(); // ID depuis l'URL
  const [selectedProduitId, setSelectedProduitId] = useState<number | null>(null);
  
  useEffect(() => {
    // Si un ID est dans l'URL, ouvrir le dÃ©tail
    if (id) {
      setSelectedProduitId(parseInt(id));
    }
  }, [id]);
  
  return (
    <>
      {/* Liste produits */}
      <ProductsList onSelectProduct={setSelectedProduitId} />
      
      {/* Drawer dÃ©tail produit */}
      <ProductDetailDrawer
        produitId={selectedProduitId}
        isOpen={selectedProduitId !== null}
        onClose={() => setSelectedProduitId(null)}
      />
    </>
  );
}
```

**Option B : Modal (comme actuellement)**
```tsx
// MÃªme logique mais avec Dialog au lieu de Drawer
<Dialog open={selectedProduitId !== null} onOpenChange={() => setSelectedProduitId(null)}>
  <DialogContent className="max-w-2xl">
    <ProductDetail produitId={selectedProduitId} />
  </DialogContent>
</Dialog>
```

### 6. Navigation avec Ã©tat (prÃ©servation du contexte)

Pour une meilleure UX, utiliser `state` dans la navigation :

```tsx
const navigate = useNavigate();

const handleClick = () => {
  navigate(`/produits/${produit.id}`, {
    state: { fromCreation: true } // Optionnel : pour tracking
  });
  
  onClose(); // Fermer le modal de crÃ©ation
};
```

---

## ğŸ¨ DESIGN DÃ‰TAILLÃ‰

### Ã‰tat normal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAIRE CHAUSSURES - 44 (EPI)          65%  â†’â”‚
â”‚ CatÃ©gorie: EPI                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ã‰tat hover
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAIRE CHAUSSURES - 44 (EPI)          65%  â†’â”‚  â† Fond gris clair
â”‚ CatÃ©gorie: EPI                              â”‚     Bordure turquoise
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Couleurs :**
- Fond hover : `bg-gray-50`
- Bordure hover : `border-teal-200`
- IcÃ´ne : `text-gray-400` (neutre) ou `text-teal-600` (au hover)
- Score â‰¥70% : `text-orange-600` (attention forte)
- Score 50-69% : `text-yellow-600` (attention modÃ©rÃ©e)
- Score <50% : `text-gray-600` (info)

### IcÃ´nes Lucide possibles
- `ExternalLink` (â†—) : SuggÃ¨re ouverture dans nouveau contexte
- `ArrowRight` (â†’) : SuggÃ¨re navigation
- `Eye` (ğŸ‘) : SuggÃ¨re visualisation

**Recommandation :** `ExternalLink` pour clartÃ©.

---

## âœ… CHECKLIST DE VALIDATION

**Backend (pas de changement) :**
- [ ] API `/api/referentiel/produits/search` fonctionne dÃ©jÃ 
- [ ] Retourne ID, nom, catÃ©gorie, score de similaritÃ©

**Frontend :**
- [ ] Les lignes produits similaires sont cliquables
- [ ] Effet hover visible (fond gris + bordure turquoise)
- [ ] IcÃ´ne flÃ¨che "â†’" ou "â†—" visible
- [ ] Clic sur une ligne â†’ modal crÃ©ation se ferme
- [ ] Redirection vers `/produits/:id`
- [ ] Panneau/modal dÃ©tail produit s'ouvre automatiquement

**UX :**
- [ ] Curseur pointer visible au survol
- [ ] Transition douce (pas de saut brutal)
- [ ] Bouton "CrÃ©er un nouveau produit" reste accessible en bas
- [ ] Pas de confusion (clairement cliquable)

**Tests :**
- [ ] Saisir "chaussure 44" â†’ similaires dÃ©tectÃ©s
- [ ] Cliquer sur "PAIRE CHAUSSURES - 44" â†’ redirection OK
- [ ] Page produit s'ouvre avec dÃ©tail "PAIRE CHAUSSURES - 44"
- [ ] Retour arriÃ¨re (navigateur) â†’ retour Ã  la liste produits

---

## ğŸ¯ FLUX UTILISATEUR FINAL

**Avant (actuel) :**
```
1. User ouvre modal "Nouveau produit"
2. Tape "chaussure 44"
3. Voit "PAIRE CHAUSSURES - 44" similaire
4. Ferme le modal
5. Cherche dans la liste "PAIRE CHAUSSURES - 44"
6. Clique sur l'icÃ´ne ğŸ‘ pour voir dÃ©tail
```
â†’ **6 Ã©tapes, frustrant**

**AprÃ¨s (avec ce brief) :**
```
1. User ouvre modal "Nouveau produit"
2. Tape "chaussure 44"
3. Voit "PAIRE CHAUSSURES - 44" similaire
4. CLIQUE directement dessus
5. DÃ©tail s'ouvre automatiquement
```
â†’ **5 Ã©tapes, fluide** âœ¨

---

## ğŸ“ NOTES

### AccessibilitÃ©
Utiliser un `<button>` (pas un `<div>`) pour les lignes cliquables :
- Support clavier (Tab + Enter)
- Lecteurs d'Ã©cran comprennent que c'est cliquable
- Meilleure sÃ©mantique HTML

### Performance
Pas d'impact : la navigation est instantanÃ©e (changement d'URL React Router).

### Alternative : Ouvrir dans nouvel onglet
Si tu veux permettre l'ouverture dans un nouvel onglet (Ctrl+Clic) :
```tsx
<a
  href={`/produits/${produit.id}`}
  onClick={(e) => {
    e.preventDefault();
    navigate(`/produits/${produit.id}`);
    onClose();
  }}
  className="..."
>
  {/* Contenu */}
</a>
```

Mais avec `<button>`, pas de clic droit â†’ "Ouvrir dans nouvel onglet".
Ã€ toi de dÃ©cider selon tes prÃ©fÃ©rences.