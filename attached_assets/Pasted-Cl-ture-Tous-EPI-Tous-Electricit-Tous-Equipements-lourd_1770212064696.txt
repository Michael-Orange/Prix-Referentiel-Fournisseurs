ClÃ´ture â†’ Tous
EPI â†’ Tous
ElectricitÃ© â†’ Tous
Equipements lourds â†’ Tous
EtanchÃ©itÃ© â†’ GÃ©omembranes, Geotextile
Monolyto â†’ Tous
Outillage-Autres â†’ Outils manuels, Mesure & traÃ§age, SÃ©curitÃ© & signalisation, Ã‰quipement & mobilier
Plomberie et Irrigation â†’ Tubes & tuyaux, Coudes, Raccords & adaptateurs, Vannes & rÃ©gulation, Bouchons & finitions, Autres, Irrigation & arrosage
Pompes â†’ Tous
âœ… 337 PRODUITS dans ton stock
ğŸ“‹ BRIEF POUR REPLIT : MISE Ã€ JOUR COMPLÃˆTE
Copie-colle ce message Ã  Replit :
ğŸ”§ CORRECTIONS IMPORTANTES Ã€ APPORTER :

## 1. SUPPRIMER TOUS LES PRIX
- Vider complÃ¨tement la table `prix_fournisseurs`
- Garder uniquement la structure (table vide)

## 2. CORRIGER LES CATÃ‰GORIES ET SOUS-SECTIONS

### CATÃ‰GORIES COMPLÃˆTES (9 au total) :
```typescript
const categories = [
  { nom: "ClÃ´ture", description: "MatÃ©riel de clÃ´ture" },
  { nom: "EPI", description: "Ã‰quipements de protection individuelle" },
  { nom: "ElectricitÃ©", description: "Ã‰quipement Ã©lectrique" },
  { nom: "Equipements lourds", description: "Ã‰quipements et machines lourdes" },
  { nom: "EtanchÃ©itÃ©", description: "MatÃ©riaux d'Ã©tanchÃ©itÃ© et gÃ©omembranes" },
  { nom: "Monolyto", description: "Produits Monolyto" },
  { nom: "Outillage-Autres", description: "Outils et Ã©quipements divers" },
  { nom: "Plomberie et Irrigation", description: "MatÃ©riel de plomberie et systÃ¨mes d'irrigation" },
  { nom: "Pompes", description: "Pompes et Ã©quipements de pompage" }
];
SOUS-SECTIONS COMPLÃˆTES (18 au total) :
const sousSections = [
  // ClÃ´ture
  { categorie: "ClÃ´ture", nom: "Tous" },
  
  // EPI
  { categorie: "EPI", nom: "Tous" },
  
  // ElectricitÃ©
  { categorie: "ElectricitÃ©", nom: "Tous" },
  
  // Equipements lourds
  { categorie: "Equipements lourds", nom: "Tous" },
  
  // EtanchÃ©itÃ©
  { categorie: "EtanchÃ©itÃ©", nom: "GÃ©omembranes" },
  { categorie: "EtanchÃ©itÃ©", nom: "Geotextile" },
  
  // Monolyto
  { categorie: "Monolyto", nom: "Tous" },
  
  // Outillage-Autres
  { categorie: "Outillage-Autres", nom: "Outils manuels" },
  { categorie: "Outillage-Autres", nom: "Mesure & traÃ§age" },
  { categorie: "Outillage-Autres", nom: "SÃ©curitÃ© & signalisation" },
  { categorie: "Outillage-Autres", nom: "Ã‰quipement & mobilier" },
  
  // Plomberie et Irrigation
  { categorie: "Plomberie et Irrigation", nom: "Tubes & tuyaux" },
  { categorie: "Plomberie et Irrigation", nom: "Coudes" },
  { categorie: "Plomberie et Irrigation", nom: "Raccords & adaptateurs" },
  { categorie: "Plomberie et Irrigation", nom: "Vannes & rÃ©gulation" },
  { categorie: "Plomberie et Irrigation", nom: "Bouchons & finitions" },
  { categorie: "Plomberie et Irrigation", nom: "Autres" },
  { categorie: "Plomberie et Irrigation", nom: "Irrigation & arrosage" },
  
  // Pompes
  { categorie: "Pompes", nom: "Tous" }
];
3. IMPORTER LES 337 PRODUITS
Le CSV complet a Ã©tÃ© fourni par Michael dans products.csv.
IMPORTANT :
GÃ©nÃ©rer les rÃ©fÃ©rences FP-001 Ã  FP-337 (pas 376)
Respecter les noms EXACTS des produits (majuscules, accents, DN, etc.)
Respecter les unitÃ©s EXACTES (u, m, "Nb de tuyaux 6m", "Rouleau de 100m", "Chute > 50cm", etc.)
NE PAS crÃ©er de prix automatiquement
Ignorer les colonnes spÃ©cifiques au stock (stock_actuel, est_template, etc.)
MAPPING DES COLONNES CSV â†’ DB :
categorie â†’ categorieId (via lookup)
sous_section â†’ sousSectionId (via lookup)
nom â†’ nom
unite â†’ uniteMesure
GÃ©nÃ©rer reference automatiquement (FP-001, FP-002, etc.)
actif â†’ true par dÃ©faut
description â†’ null (on remplira plus tard)
4. RÃ‰SULTAT ATTENDU APRÃˆS SEED
âœ… 9 catÃ©gories crÃ©Ã©es (ClÃ´ture, EPI, ElectricitÃ©, Equipements lourds, EtanchÃ©itÃ©, Monolyto, Outillage-Autres, Plomberie et Irrigation, Pompes)
âœ… 18 sous-sections crÃ©Ã©es
âœ… 337 produits crÃ©Ã©s avec rÃ©fÃ©rences FP-001 Ã  FP-337
âŒ 0 prix dans la table prix_fournisseurs
âœ… 4 fournisseurs crÃ©Ã©s (ABC MatÃ©riaux, Dakar Pro BTP, Amadou MatÃ©riaux, MarchÃ© Sandaga)
5. SCRIPT DE SEED MODIFIÃ‰
import { parse } from 'csv-parse/sync';
import { readFileSync } from 'fs';
import { join } from 'path';

export async function seedData() {
  console.log("ğŸš€ Seeding database...");
  
  // 1. CrÃ©er les catÃ©gories
  const categoriesData = [
    { nom: "ClÃ´ture", description: "MatÃ©riel de clÃ´ture", ordre: 1 },
    { nom: "EPI", description: "Ã‰quipements de protection individuelle", ordre: 2 },
    { nom: "ElectricitÃ©", description: "Ã‰quipement Ã©lectrique", ordre: 3 },
    { nom: "Equipements lourds", description: "Ã‰quipements et machines lourdes", ordre: 4 },
    { nom: "EtanchÃ©itÃ©", description: "MatÃ©riaux d'Ã©tanchÃ©itÃ©", ordre: 5 },
    { nom: "Monolyto", description: "Produits Monolyto", ordre: 6 },
    { nom: "Outillage-Autres", description: "Outils et Ã©quipements divers", ordre: 7 },
    { nom: "Plomberie et Irrigation", description: "MatÃ©riel de plomberie", ordre: 8 },
    { nom: "Pompes", description: "Pompes et Ã©quipements de pompage", ordre: 9 }
  ];
  
  for (const cat of categoriesData) {
    await storage.createCategory(cat);
  }
  console.log("âœ… 9 catÃ©gories crÃ©Ã©es");
  
  // 2. CrÃ©er les sous-sections
  const sousSectionsData = [
    { categorie: "ClÃ´ture", nom: "Tous", ordre: 0 },
    { categorie: "EPI", nom: "Tous", ordre: 0 },
    { categorie: "ElectricitÃ©", nom: "Tous", ordre: 0 },
    { categorie: "Equipements lourds", nom: "Tous", ordre: 0 },
    { categorie: "EtanchÃ©itÃ©", nom: "GÃ©omembranes", ordre: 1 },
    { categorie: "EtanchÃ©itÃ©", nom: "Geotextile", ordre: 2 },
    { categorie: "Monolyto", nom: "Tous", ordre: 0 },
    { categorie: "Outillage-Autres", nom: "Outils manuels", ordre: 1 },
    { categorie: "Outillage-Autres", nom: "Mesure & traÃ§age", ordre: 2 },
    { categorie: "Outillage-Autres", nom: "SÃ©curitÃ© & signalisation", ordre: 3 },
    { categorie: "Outillage-Autres", nom: "Ã‰quipement & mobilier", ordre: 4 },
    { categorie: "Plomberie et Irrigation", nom: "Tubes & tuyaux", ordre: 1 },
    { categorie: "Plomberie et Irrigation", nom: "Coudes", ordre: 2 },
    { categorie: "Plomberie et Irrigation", nom: "Raccords & adaptateurs", ordre: 3 },
    { categorie: "Plomberie et Irrigation", nom: "Vannes & rÃ©gulation", ordre: 4 },
    { categorie: "Plomberie et Irrigation", nom: "Bouchons & finitions", ordre: 5 },
    { categorie: "Plomberie et Irrigation", nom: "Autres", ordre: 6 },
    { categorie: "Plomberie et Irrigation", nom: "Irrigation & arrosage", ordre: 7 },
    { categorie: "Pompes", nom: "Tous", ordre: 0 }
  ];
  
  const categories = await storage.getAllCategories();
  const categoriesMap = new Map(categories.map(c => [c.nom, c.id]));
  
  for (const ss of sousSectionsData) {
    const categorieId = categoriesMap.get(ss.categorie);
    await storage.createSousSection({ 
      categorieId, 
      nom: ss.nom, 
      ordre: ss.ordre 
    });
  }
  console.log("âœ… 18 sous-sections crÃ©Ã©es");
  
  // 3. CrÃ©er les fournisseurs
  const fournisseursData = [
    { nom: "ABC MatÃ©riaux", tvaApplicable: true },
    { nom: "Dakar Pro BTP", tvaApplicable: true },
    { nom: "Amadou MatÃ©riaux", tvaApplicable: false },
    { nom: "MarchÃ© Sandaga", tvaApplicable: false }
  ];
  
  for (const f of fournisseursData) {
    await storage.createFournisseur(f);
  }
  console.log("âœ… 4 fournisseurs crÃ©Ã©s");
  
  // 4. Importer les produits depuis le CSV
  const csvPath = join(process.cwd(), "products.csv");
  const csvContent = readFileSync(csvPath, "utf-8");
  const records = parse(csvContent, {
    columns: true,
    skip_empty_lines: true,
    trim: true
  });
  
  const sousSections = await storage.getAllSousSections();
  const ssMap = new Map();
  for (const ss of sousSections) {
    const cat = categories.find(c => c.id === ss.categorieId);
    ssMap.set(`${cat.nom}|${ss.nom}`, ss.id);
  }
  
  let compteur = 1;
  const seen = new Set();
  
  for (const record of records) {
    const key = `${record.categorie}|${record.sous_section}|${record.nom}`;
    if (seen.has(key)) continue;
    seen.add(key);
    
    const categorieId = categoriesMap.get(record.categorie);
    const sousSectionId = ssMap.get(`${record.categorie}|${record.sous_section}`);
    
    if (!categorieId || !sousSectionId) continue;
    
    // Nettoyer l'unitÃ© (enlever les "(s)" et autres variations)
    let unite = record.unite.replace(/\(s\)/g, '').trim();
    if (unite === 'unitÃ©') unite = 'u';
    if (unite === 'mÃ¨tre') unite = 'm';
    
    const reference = `FP-${compteur.toString().padStart(3, '0')}`;
    
    await storage.createProduit({
      reference,
      nom: record.nom,
      categorieId,
      sousSectionId,
      uniteMesure: unite,
      actif: true
    });
    
    compteur++;
  }
  
  console.log(`âœ… ${compteur - 1} produits crÃ©Ã©s avec rÃ©fÃ©rences FP-001 Ã  FP-${(compteur - 1).toString().padStart(3, '0')}`);
  
  // 5. NE PAS crÃ©er de prix
  console.log("âœ… Table prix_fournisseurs vide (Ã  saisir manuellement)");
  
  console.log("ğŸ‰ Seed terminÃ© !");
}
6. NOTES IMPORTANTES
UnitÃ©s spÃ©ciales Ã  gÃ©rer :
"unitÃ©(s)" â†’ "u"
"mÃ¨tre(s)" â†’ "m"
"Nb de tuyaux 6m" â†’ conserver tel quel
"Rouleau de 100m" â†’ conserver tel quel
"Rouleau de 50m" â†’ conserver tel quel
"Chute > 50cm" â†’ conserver tel quel
"Chute > 3m (et inf. Ã  10m)" â†’ conserver tel quel
"L" â†’ conserver tel quel
Gestion des doublons :
Certains produits apparaissent plusieurs fois avec des unitÃ©s diffÃ©rentes (ex: "EVAC - DN 110" en "Nb de tuyaux 6m" ET "Chute de moins de 6m").
â†’ Ce sont des produits DISTINCTS, les crÃ©er tous.
Nettoyage :
Supprimer les templates (est_template = true)
Supprimer les produits inactifs (actif = false)