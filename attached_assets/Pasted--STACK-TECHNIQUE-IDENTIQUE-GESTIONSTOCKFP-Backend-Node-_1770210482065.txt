## STACK TECHNIQUE (IDENTIQUE √Ä GESTIONSTOCKFP)

### Backend
- Node.js + Express
- TypeScript
- Drizzle ORM (m√™me ORM que Stock)
- PostgreSQL (Replit Database)

### Frontend
- React + TypeScript
- TanStack Query (react-query) pour gestion √©tat
- Tailwind CSS pour styling
- Vite comme bundler

### Architecture
/
‚îú‚îÄ‚îÄ client/              # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/  # Composants UI r√©utilisables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/       # Pages principales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/       # Custom hooks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/         # Utilitaires
‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ server/              # Backend Express
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Routes API modulaires
‚îÇ   ‚îú‚îÄ‚îÄ services/        # Logique m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ db.ts            # Connexion DB
‚îÇ   ‚îú‚îÄ‚îÄ storage.ts       # Couche d'acc√®s donn√©es
‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # Point d'entr√©e
‚îú‚îÄ‚îÄ shared/              # Code partag√©
‚îÇ   ‚îî‚îÄ‚îÄ schema.ts        # Sch√©ma DB Drizzle + types
‚îî‚îÄ‚îÄ package.json

## SCH√âMA DE BASE DE DONN√âES

### Table : fournisseurs
```typescript
export const fournisseurs = pgTable("fournisseurs", {
  id: serial("id").primaryKey(),
  nom: text("nom").notNull().unique(),
  tvaApplicable: boolean("tva_applicable").notNull().default(true),
  actif: boolean("actif").notNull().default(true),
  dateCreation: timestamp("date_creation").notNull().defaultNow(),
});
SIMPLIFI√â : Uniquement le nom du fournisseur et son statut TVA
tvaApplicable = true ‚Üí Fournisseur officiel avec TVA √† 18%
tvaApplicable = false ‚Üí Fournisseur informel, TVA √† 0%
Table : categories
export const categories = pgTable("categories", {
  id: serial("id").primaryKey(),
  nom: text("nom").notNull().unique(),
  description: text("description"),
  ordre: integer("ordre").notNull().default(0),
});
Table : sous_sections
export const sousSections = pgTable("sous_sections", {
  id: serial("id").primaryKey(),
  categorieId: integer("categorie_id").notNull(),
  nom: text("nom").notNull(),
  description: text("description"),
  ordre: integer("ordre").notNull().default(0),
});
Table : produits
export const produits = pgTable("produits", {
  id: serial("id").primaryKey(),
  reference: text("reference").notNull().unique(), // Format FP-XXX auto-g√©n√©r√©
  nom: text("nom").notNull(),
  description: text("description"),
  categorieId: integer("categorie_id").notNull(),
  sousSectionId: integer("sous_section_id"),
  uniteMesure: text("unite_mesure").notNull(),
  actif: boolean("actif").notNull().default(true),
  dateCreation: timestamp("date_creation").notNull().defaultNow(),
  dateModification: timestamp("date_modification").notNull().defaultNow(),
});
R√©f√©rence auto-g√©n√©r√©e :
Format : FP-XXX o√π XXX est un compteur √† 3 chiffres avec z√©ro devant
Exemples : FP-001, FP-002, ..., FP-010, ..., FP-100, FP-999
Logique : r√©cup√©rer le dernier ID + 1 et formater
Table : prix_fournisseurs
export const prixFournisseurs = pgTable("prix_fournisseurs", {
  id: serial("id").primaryKey(),
  produitId: integer("produit_id").notNull(),
  fournisseurId: integer("fournisseur_id").notNull(),
  prixHT: real("prix_ht").notNull(), // en FCFA
  tauxTVA: real("taux_tva").notNull(), // 18.00 ou 0.00 (peut √™tre overrid√©)
  prixTTC: real("prix_ttc").notNull(), // en FCFA
  dateDebutValidite: timestamp("date_debut_validite").notNull().defaultNow(),
  dateFinValidite: timestamp("date_fin_validite"),
  actif: boolean("actif").notNull().default(true),
  remarques: text("remarques"),
  tvaOverride: boolean("tva_override").notNull().default(false),
  dateCreation: timestamp("date_creation").notNull().defaultNow(),
});
Logique TVA :
Si tauxTVA = 0 ‚Üí prixTTC = prixHT (pas de taxe)
Si tauxTVA = 18 ‚Üí prixTTC = prixHT √ó 1.18
Si tvaOverride = true ‚Üí afficher avertissement dans l'UI
Index compos√© unique : (produit_id, fournisseur_id, date_fin_validite)
Table : modifications_log
export const modificationsLog = pgTable("modifications_log", {
  id: serial("id").primaryKey(),
  tableName: text("table_name").notNull(),
  recordId: integer("record_id").notNull(),
  action: text("action").notNull(),
  champModifie: text("champ_modifie"),
  ancienneValeur: text("ancienne_valeur"),
  nouvelleValeur: text("nouvelle_valeur"),
  dateModification: timestamp("date_modification").notNull().defaultNow(),
});
FONCTIONNALIT√âS INTERFACE UTILISATEUR
Authentification
Page de login simple avec mot de passe partag√©
Session stock√©e
Variable d'environnement PASSWORD
Navigation principale
Tableau de bord
Fournisseurs
Cat√©gories & Sous-sections
Produits & Prix (page principale)
Historique
Page : Gestion Fournisseurs
Liste fournisseurs :
Colonnes : Nom | TVA applicable | Statut | Actions
Badge visuel : "TVA 18%" (vert) ou "Sans TVA" (gris)
Recherche par nom
Filtre : Avec TVA / Sans TVA / Tous
Bouton "Ajouter un fournisseur"
Formulaire ajout/modification (SIMPLIFI√â) :
Nom (obligatoire, unique)
Toggle "Assujetti √† la TVA" (d√©faut : OUI)
Tooltip : "Les fournisseurs informels ne sont pas assujettis √† la TVA"
Statut actif/inactif
Compteur de produits fournis
Page : Gestion Cat√©gories & Sous-sections
Cat√©gories √† cr√©er au seed (EXACTES depuis GestionStockFP) :
Outillage-Autres
Plomberie et Irrigation
Electricit√©
EPI
Sous-sections √† cr√©er au seed (EXACTES depuis GestionStockFP) :
Outillage-Autres :
Tous
Outils manuels
Mesure & tra√ßage
S√©curit√© & signalisation
√âquipement & mobilier
Plomberie et Irrigation :
Tous
Tubes & tuyaux
Coudes
Raccords & adaptateurs
Vannes & r√©gulation
Bouchons & finitions
Irrigation & arrosage
Electricit√© :
Tous
EPI :
Tous
Fonctionnalit√©s :
Arbre hi√©rarchique
Drag & drop pour r√©organiser
Ajouter / Modifier / Supprimer
Compteur de produits
Page : Gestion Produits & Prix (PAGE PRINCIPALE)
Tableau produits :
Filtres : Cat√©gorie | Sous-section | Fournisseur | Statut | Recherche
Colonnes : R√©f√©rence | Nom | Cat√©gorie/Sous-section | Unit√© | Prix min HT | Prix min TTC | Actions
Affichage devise : "12 500 FCFA" (espace tous les 3 chiffres)
Formulaire Ajouter un produit :
R√©f√©rence : Auto-g√©n√©r√©e (afficher "Sera g√©n√©r√©e automatiquement : FP-XXX"), champ d√©sactiv√©
Nom (obligatoire)
Description
Cat√©gorie (select)
Sous-section (select conditionnel)
Unit√© (select : u, m, ml, m¬≤, tonne, m¬≥, kg, L, "Nb de tuyaux 6m", "Chute de moins de 6m", "Rouleau de 100m", "Rouleau de 50m", "Moins d'un rouleau entier")
Fournisseur(s) + Prix
Statut actif
Formulaire Ajouter/Modifier un prix (modal) :
S√©lection fournisseur
Dropdown fournisseurs actifs
Badge TVA affich√© : "TVA 18%" ou "Sans TVA"
TVA pr√©-remplie automatiquement
Saisie du prix (toggle entre 2 modes) :
Mode Saisie Prix HT (d√©faut) :
Champ "Prix HT (FCFA)" (input nombre)
Champ "Taux TVA (%)" (pr√©-rempli, modifiable)
Si modifi√© et diff√©rent du profil fournisseur ‚Üí tvaOverride = true
Afficher ic√¥ne warning + tooltip : "‚ö†Ô∏è TVA modifi√©e manuellement (diff√©rent du profil fournisseur)"
Champ "Prix TTC (FCFA)" (calcul√© auto, lecture seule)
Si TVA = 0% : afficher "Prix HT = Prix TTC (sans TVA)"
Mode Saisie Prix TTC :
Champ "Prix TTC (FCFA)" (input nombre)
Champ "Taux TVA (%)" (pr√©-rempli, modifiable)
Champ "Prix HT (FCFA)" (calcul√© auto, lecture seule)
M√™me logique override
Informations compl√©mentaires :
Date d√©but validit√© (d√©faut : aujourd'hui)
Date fin validit√© (optionnel)
Remarques
Actif (toggle)
Calculs automatiques :
TVA 18% : TTC = HT √ó 1.18 | HT = TTC / 1.18
TVA 0% : HT = TTC
Arrondi √† 2 d√©cimales
Validation coh√©rence
D√©tails produit :
Infos produit (r√©f√©rence FP-XXX non modifiable)
Liste prix fournisseurs avec badge TVA
Si tvaOverride = true : afficher ic√¥ne warning avec tooltip
Historique prix (timeline)
Graphique √©volution prix HT
Page : Historique
Log modifications
Filtres par date, table, action
Export CSV
Import/Export CSV
Export :
Format : Reference | Nom | Categorie | Sous-section | Unit√© | Fournisseur | TVA_Applicable | Prix_HT_FCFA | Taux_TVA | Prix_TTC_FCFA | TVA_Override | Date_validite | Actif
API REST
Configuration
API Key en variable d'environnement
Header : X-API-Key: <cl√©>
R√©ponses JSON
Format standard
{
  "success": true,
  "data": [...],
  "meta": {
    "total": 150,
    "timestamp": "2026-02-04T11:00:00Z"
  }
}
Endpoints
GET /api/produits
Liste produits actifs avec prix min
GET /api/produits/:id
D√©tails complets
GET /api/produits/recherche
Query param : ?q=keyword
GET /api/produits/reference/:reference
Recherche par r√©f√©rence exacte (ex: FP-001)
GET /api/prix/produit/:produitId
Prix actuel pour tous fournisseurs
GET /api/prix/historique/:produitId
Historique des prix
GET /api/categories
Liste cat√©gories avec sous-sections
GET /api/fournisseurs
Liste fournisseurs actifs
POST /api/valorisation
Pour app Stock
Produits
Item 1
Reference
FP-001
Quantite
100
Item 2
Reference
FP-002
Quantite
50
Fournisseur Preference
moins_cher
S√âCURIT√â
Interface
Authentification mot de passe partag√©
Session Express
Protection CSRF
Validation Zod
API
API Key obligatoire
Rate limiting (100 req/min)
Validation param√®tres
Consultation uniquement (pas de DELETE via API)
VALIDATION DONN√âES
Produits
R√©f√©rence unique auto-g√©n√©r√©e (FP-XXX)
Nom non vide
Cat√©gorie et unit√© obligatoires
Prix
Prix HT > 0 (en FCFA)
Taux TVA entre 0 et 100 (typiquement 0 ou 18)
Prix TTC coh√©rent (tol√©rance ¬±0.01)
Si TVA = 0 : HT = TTC
Si TVA = 18 : TTC = HT √ó 1.18
Un seul prix actif par (produit, fournisseur)
Fournisseurs
Nom unique
Pas de champs email/t√©l√©phone (simplification)
Override TVA
Si tvaOverride = true : logger dans modifications_log
Afficher avertissement dans UI
DONN√âES DE TEST (SEED)
Fournisseurs (SIMPLIFI√âS)
[
  { nom: "ABC Mat√©riaux", tvaApplicable: true },
  { nom: "Dakar Pro BTP", tvaApplicable: true },
  { nom: "Amadou Mat√©riaux", tvaApplicable: false },
  { nom: "March√© Sandaga", tvaApplicable: false }
]
Cat√©gories et Sous-sections (EXACTES depuis GestionStockFP)
Cr√©er les cat√©gories et sous-sections list√©es ci-dessus.
Produits avec prix (EXEMPLES ISSUS DE GESTIONSTOCKFP)
Produits √† cr√©er en priorit√© (avec libell√©s EXACTS) :
// Outillage-Autres > Outils manuels
FP-001 : PELLE (u)
  - ABC Mat√©riaux : 8000 HT, TVA 18%, 9440 TTC
  - Amadou Mat√©riaux : 7000 (sans TVA)

FP-002 : PIOCHE (u)
  - ABC Mat√©riaux : 6500 HT, TVA 18%, 7670 TTC
  - March√© Sandaga : 6000 (sans TVA)

FP-003 : BROUETTE (u)
  - Dakar Pro BTP : 35000 HT, TVA 18%, 41300 TTC

FP-004 : MARTEAU (u)
  - ABC Mat√©riaux : 2500 HT, TVA 18%, 2950 TTC

FP-005 : SEAUX (u)
  - Amadou Mat√©riaux : 1000 (sans TVA)

// Outillage-Autres > Mesure & tra√ßage
FP-006 : DECAMETRE 20m (u)
  - ABC Mat√©riaux : 4000 HT, TVA 18%, 4720 TTC

FP-007 : NIVEAU A BULLE - PM (u)
  - Dakar Pro BTP : 3500 HT, TVA 18%, 4130 TTC

// Plomberie et Irrigation > Tubes & tuyaux
FP-008 : PRESSION - DN 50 (Nb de tuyaux 6m)
  - Dakar Pro BTP : 12000 HT, TVA 18%, 14160 TTC

FP-009 : JR - DN 32 - PN 6 (Rouleau de 100m)
  - ABC Mat√©riaux : 85000 HT, TVA 18%, 100300 TTC

FP-010 : EVAC - DN 110 (Nb de tuyaux 6m)
  - Dakar Pro BTP : 8500 HT, TVA 18%, 10030 TTC

// Plomberie et Irrigation > Coudes
FP-011 : COUDE PRESSION 90¬∞ - DN 63 (u)
  - ABC Mat√©riaux : 800 HT, TVA 18%, 944 TTC

FP-012 : COUDE JR - DN 32 (u)
  - ABC Mat√©riaux : 350 HT, TVA 18%, 413 TTC

// Plomberie et Irrigation > Bouchons & finitions
FP-013 : COLLE PVC 1L (u)
  - ABC Mat√©riaux : 6000 HT, TVA 18%, 7080 TTC
  - Amadou Mat√©riaux : 5500 (sans TVA)

FP-014 : BOUCHON PRESSION - DN 110 (u)
  - ABC Mat√©riaux : 450 HT, TVA 18%, 531 TTC

// Plomberie et Irrigation > Vannes & r√©gulation
FP-015 : VANNE PRESSION - DN 50 (u)
  - Dakar Pro BTP : 4500 HT, TVA 18%, 5310 TTC

// Plomberie et Irrigation > Irrigation & arrosage
FP-016 : GOUTTEURS - 8L / H (u)
  - ABC Mat√©riaux : 150 HT, TVA 18%, 177 TTC

FP-017 : ASPERSEUR - 32L / H (u)
  - Dakar Pro BTP : 2500 HT, TVA 18%, 2950 TTC

// Electricit√©
FP-018 : CABLE A05VVF 3 x 1.5mm (m)
  - ABC Mat√©riaux : 800 HT, TVA 18%, 944 TTC

FP-019 : DISJONCTEUR MODULAIRE 16A (u)
  - Dakar Pro BTP : 3200 HT, TVA 18%, 3776 TTC

FP-020 : GAINE ANNELE - D 32 (m)
  - ABC Mat√©riaux : 500 HT, TVA 18%, 590 TTC

// EPI
FP-021 : CASQUE BLANC (u)
  - ABC Mat√©riaux : 3000 HT, TVA 18%, 3540 TTC

FP-022 : PAIRE GANTS (u)
  - March√© Sandaga : 800 (sans TVA)

FP-023 : GILET JAUNE (u)
  - ABC Mat√©riaux : 2000 HT, TVA 18%, 2360 TTC
Ajouter quelques prix historiques pour 2-3 produits pour tester la timeline.
OPTIMISATION REPLIT AUTOSCALE
Cold start acceptable
Pas de health check permanent
Index DB sur colonnes recherch√©es
Cache optionnel (Map en m√©moire, TTL 5min)
DESIGN UI
Tailwind CSS
Composants r√©utilisables
Responsive
Badges visuels pour TVA (vert/gris)
Ic√¥ne warning pour override TVA
Format devise : "12 500 FCFA" (espaces)
Toast notifications
Loading states
FORMATAGE DES PRIX
Affichage :
Format : Nombre avec espaces tous les 3 chiffres + " FCFA"
Exemples : "12 500 FCFA", "1 250 000 FCFA"
2 d√©cimales si centimes (rare en FCFA)
Saisie :
Input type="number"
Validation : nombres positifs uniquement
Arrondi √† 2 d√©cimales en backend
G√âN√âRATION R√âF√âRENCE PRODUIT
Logique :
async function genererReference(): Promise<string> {
  const dernierProduit = await db.select().from(produits).orderBy(desc(produits.id)).limit(1);
  
  let numero = 1;
  if (dernierProduit.length > 0 && dernierProduit[0].reference) {
    const match = dernierProduit[0].reference.match(/FP-(\d+)/);
    if (match) {
      numero = parseInt(match[1]) + 1;
    }
  }
  
  return `FP-${numero.toString().padStart(3, '0')}`;
}
UTILITAIRES CALCULS TVA
// shared/utils/calculs.ts
export function calculerTTC(prixHT: number, tauxTVA: number): number {
  if (tauxTVA === 0) return prixHT;
  return Math.round(prixHT * (1 + tauxTVA / 100) * 100) / 100;
}

export function calculerHT(prixTTC: number, tauxTVA: number): number {
  if (tauxTVA === 0) return prixTTC;
  return Math.round((prixTTC / (1 + tauxTVA / 100)) * 100) / 100;
}

export function validerCoherence(prixHT: number, tauxTVA: number, prixTTC: number): boolean {
  const ttcCalcule = calculerTTC(prixHT, tauxTVA);
  return Math.abs(ttcCalcule - prixTTC) <= 0.01;
}

export function formaterPrixFCFA(montant: number): string {
  return `${montant.toLocaleString('fr-FR')} FCFA`;
}
DOCUMENTATION README
Inclure :
Vue d'ensemble
Installation et d√©marrage
Variables d'environnement (.env.example)
Section TVA S√©n√©gal : TVA 18%, fournisseurs avec/sans TVA, override manuel
Section Devise : FCFA unique
Section R√©f√©rence : Auto-g√©n√©ration FP-XXX
Section Alignement avec GestionStockFP : Structure cat√©gories/sous-sections/produits identique
Documentation API avec exemples curl
Format CSV import/export
Sch√©ma base de donn√©es
LIVRABLES
‚úÖ Application web fonctionnelle
‚úÖ Table fournisseurs simplifi√©e (nom + TVA uniquement)
‚úÖ R√©f√©rence auto-g√©n√©r√©e FP-XXX
‚úÖ Gestion TVA 18% / 0% avec override manuel
‚úÖ Devise FCFA partout
‚úÖ Cat√©gories/sous-sections EXACTES depuis GestionStockFP
‚úÖ Produits d'exemple avec libell√©s EXACTS
‚úÖ Base PostgreSQL seed√©e
‚úÖ API REST document√©e
‚úÖ Authentification UI + API
‚úÖ Export CSV
‚úÖ Historique prix avec timeline
‚úÖ README complet
‚úÖ .env.example
‚úÖ Script seed
POINTS D'ATTENTION REPLIT
Table fournisseurs simplifi√©e : Pas de champs contact/email/t√©l√©phone
R√©f√©rence auto : Fonction genererReference() appel√©e √† chaque cr√©ation produit
Override TVA : Champ tvaOverride + warning UI + logs
Devise FCFA : Affich√©e partout, format avec espaces
Calculs TVA : Utiliser fonctions utilitaires partag√©es
Cat√©gories/sous-sections : EXACTEMENT celles de GestionStockFP
Libell√©s produits : EXACTEMENT ceux de GestionStockFP (majuscules, accents, DN, etc.)
Unit√©s : Respecter les unit√©s sp√©cifiques (u, m, ml, "Nb de tuyaux 6m", "Rouleau de 100m", etc.)
Validation : Coh√©rence HT/TVA/TTC avec tol√©rance ¬±0.01
Historique : date_fin_validite sur ancien prix lors modification
Logs : Logger les override TVA dans modifications_log
Types TypeScript : Partager via /shared
Gestion erreurs : Middleware centralis√©
Index DB : Sur reference, nom, categorie_id, actif
√âVOLUTIONS FUTURES
Import CSV massif
Remises fournisseurs
Alertes variations prix
Comparateur prix avec/sans TVA
Conditionnements
Photos produits
Fiches techniques PDF
Synchronisation automatique avec app Stock (matching par cat√©gorie + sous-section + nom)
Export PDF catalogues
Multi-devises (si import international)
Taux TVA personnalis√©s (rares)

---

## ‚úÖ MODIFICATIONS FINALES APPORT√âES

**Table fournisseurs** :
- ‚úÖ **SIMPLIFI√â** : Uniquement `nom`, `tvaApplicable`, `actif`, `dateCreation`
- ‚ùå Supprim√© : `contact`, `email`, `telephone`

**Cat√©gories et sous-sections** :
- ‚úÖ **EXACTES** depuis GestionStockFP : Outillage-Autres, Plomberie et Irrigation, Electricit√©, EPI
- ‚úÖ Sous-sections correspondantes (Tous, Outils manuels, Tubes & tuyaux, etc.)

**Produits seed** :
- ‚úÖ **LIBELL√âS EXACTS** : PELLE, PIOCHE, COUDE PRESSION 90¬∞ - DN 63, JR - DN 32 - PN 6, etc.
- ‚úÖ **UNIT√âS EXACTES** : u, m, ml, "Nb de tuyaux 6m", "Rouleau de 100m"
- ‚úÖ 23 produits repr√©sentatifs avec prix vari√©s (TVA 18% et 0%)

---

## üéØ C'EST PR√äT POUR LE BUILD !

Le brief est maintenant **parfaitement align√©** avec ton app Stock existante. Le matching futur sera facile car :
- M√™mes cat√©gories
- M√™mes sous-sections
- M√™mes libell√©s de produits
- M√™mes unit√©s

Tu peux copier-coller ce brief dans Replit Agent. Une fois l'app cr√©√©e, l'int√©gration avec le Stock et le Calculateur sera smooth ! üöÄ

Des derni√®res questions avant de lancer ?